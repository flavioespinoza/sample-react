<!DOCTYPE html>
<html>
<head>
    <title>README</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet"
          href="file:////Users/flavio/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.5.18/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">

    <style>
        code[class*="language-"],
        pre[class*="language-"] {
            color: #a9b7c6;
            font-family: Consolas, Monaco, 'Andale Mono', monospace;
            direction: ltr;
            text-align: left;
            white-space: pre;
            word-spacing: normal;
            word-break: normal;
            line-height: 1.5;
            -moz-tab-size: 4;
            -o-tab-size: 4;
            tab-size: 4;
            -webkit-hyphens: none;
            -moz-hyphens: none;
            -ms-hyphens: none;
            hyphens: none;
        }

        pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
        code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
            color: inherit;
            background: rgba(33, 66, 131, .85);
        }

        pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
        code[class*="language-"]::selection, code[class*="language-"] ::selection {
            color: inherit;
            background: rgba(33, 66, 131, .85);
        }

        /* Code blocks */
        pre[class*="language-"] {
            padding: 1em;
            margin: .5em 0;
            overflow: auto;
        }

        :not(pre) > code[class*="language-"],
        pre[class*="language-"] {
            background: #2b2b2b;
        }

        /* Inline code */
        :not(pre) > code[class*="language-"] {
            padding: .1em;
            border-radius: .3em;
        }

        .token.comment,
        .token.prolog,
        .token.cdata {
            color: #808080;
        }

        .token.delimiter,
        .token.boolean,
        .token.keyword,
        .token.selector,
        .token.important,
        .token.atrule {
            color: #cc7832;
        }

        .token.operator,
        .token.punctuation,
        .token.attr-name {
            color: #a9b7c6;
        }

        .token.tag,
        .token.tag .punctuation,
        .token.doctype,
        .token.builtin {
            color: #e8bf6a;
        }

        .token.entity,
        .token.number,
        .token.symbol {
            color: #6897bb;
        }

        .token.property,
        .token.constant,
        .token.variable {
            color: #9876aa;
        }

        .token.string,
        .token.char {
            color: #6a8759;
        }

        .token.attr-value,
        .token.attr-value .punctuation {
            color: #a5c261;
        }

        .token.attr-value .punctuation:first-child {
            color: #a9b7c6;
        }

        .token.url {
            color: #287bde;
            text-decoration: underline;
        }

        .token.function {
            color: #ffc66d;
        }

        .token.regex {
            background: #364135;
        }

        .token.bold {
            font-weight: bold;
        }

        .token.italic {
            font-style: italic;
        }

        .token.inserted {
            background: #294436;
        }

        .token.deleted {
            background: #484a4a;
        }

        /*code.language-css .token.punctuation {
            color: #cc7832;
        }*/

        code.language-css .token.property,
        code.language-css .token.property + .token.punctuation {
            color: #a9b7c6;
        }

        code.language-css .token.id {
            color: #ffc66d;
        }

        code.language-css .token.selector > .token.class,
        code.language-css .token.selector > .token.attribute,
        code.language-css .token.selector > .token.pseudo-class,
        code.language-css .token.selector > .token.pseudo-element {
            color: #ffc66d;
        }

        /* highlight */
        pre[data-line] {
            position: relative;
            padding: 1em 0 1em 3em;
        }

        pre[data-line] .line-highlight-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            background-color: transparent;
            display: block;
            width: 100%;
        }

        pre[data-line] .line-highlight {
            position: absolute;
            left: 0;
            right: 0;
            padding: inherit 0;
            margin-top: 1em;
            background: hsla(24, 20%, 50%, .08);
            background: linear-gradient(to right, hsla(24, 20%, 50%, .1) 70%, hsla(24, 20%, 50%, 0));
            pointer-events: none;
            line-height: inherit;
            white-space: pre;
        }

        pre[data-line] .line-highlight:before,
        pre[data-line] .line-highlight[data-end]:after {
            content: attr(data-start);
            position: absolute;
            top: .4em;
            left: .6em;
            min-width: 1em;
            padding: 0 .5em;
            background-color: hsla(24, 20%, 50%, .4);
            color: hsl(24, 20%, 95%);
            font: bold 65%/1.5 sans-serif;
            text-align: center;
            vertical-align: .3em;
            border-radius: 999px;
            text-shadow: none;
            box-shadow: 0 1px white;
        }

        pre[data-line] .line-highlight[data-end]:after {
            content: attr(data-end);
            top: auto;
            bottom: .4em;
        }

        html body {
            font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            background-color: #fff;
            overflow: initial;
            box-sizing: border-box;
            word-wrap: break-word
        }

        html body > :first-child {
            margin-top: 0
        }

        html body h1, html body h2, html body h3, html body h4, html body h5, html body h6 {
            line-height: 1.2;
            margin-top: 1em;
            margin-bottom: 16px;
            color: #000
        }

        html body h1 {
            font-size: 2.25em;
            font-weight: 300;
            padding-bottom: .3em
        }

        html body h2 {
            font-size: 1.75em;
            font-weight: 400;
            padding-bottom: .3em
        }

        html body h3 {
            font-size: 1.5em;
            font-weight: 500
        }

        html body h4 {
            font-size: 1.25em;
            font-weight: 600
        }

        html body h5 {
            font-size: 1.1em;
            font-weight: 600
        }

        html body h6 {
            font-size: 1em;
            font-weight: 600
        }

        html body h1, html body h2, html body h3, html body h4, html body h5 {
            font-weight: 600
        }

        html body h5 {
            font-size: 1em
        }

        html body h6 {
            color: #5c5c5c
        }

        html body strong {
            color: #000
        }

        html body del {
            color: #5c5c5c
        }

        html body a:not([href]) {
            color: inherit;
            text-decoration: none
        }

        html body a {
            color: #08c;
            text-decoration: none
        }

        html body a:hover {
            color: #00a3f5;
            text-decoration: none
        }

        html body img {
            max-width: 100%
        }

        html body > p {
            margin-top: 0;
            margin-bottom: 16px;
            word-wrap: break-word
        }

        html body > ul, html body > ol {
            margin-bottom: 16px
        }

        html body ul, html body ol {
            padding-left: 2em
        }

        html body ul.no-list, html body ol.no-list {
            padding: 0;
            list-style-type: none
        }

        html body ul ul, html body ul ol, html body ol ol, html body ol ul {
            margin-top: 0;
            margin-bottom: 0
        }

        html body li {
            margin-bottom: 0
        }

        html body li.task-list-item {
            list-style: none
        }

        html body li > p {
            margin-top: 0;
            margin-bottom: 0
        }

        html body .task-list-item-checkbox {
            margin: 0 .2em .25em -1.8em;
            vertical-align: middle
        }

        html body .task-list-item-checkbox:hover {
            cursor: pointer
        }

        html body blockquote {
            margin: 16px 0;
            font-size: inherit;
            padding: 0 15px;
            color: #5c5c5c;
            background-color: #f0f0f0;
            border-left: 4px solid #d6d6d6
        }

        html body blockquote > :first-child {
            margin-top: 0
        }

        html body blockquote > :last-child {
            margin-bottom: 0
        }

        html body hr {
            height: 4px;
            margin: 32px 0;
            background-color: #d6d6d6;
            border: 0 none
        }

        html body table {
            margin: 10px 0 15px 0;
            border-collapse: collapse;
            border-spacing: 0;
            display: block;
            width: 100%;
            overflow: auto;
            word-break: normal;
            word-break: keep-all
        }

        html body table th {
            font-weight: bold;
            color: #000
        }

        html body table td, html body table th {
            border: 1px solid #d6d6d6;
            padding: 6px 13px
        }

        html body dl {
            padding: 0
        }

        html body dl dt {
            padding: 0;
            margin-top: 16px;
            font-size: 1em;
            font-style: italic;
            font-weight: bold
        }

        html body dl dd {
            padding: 0 16px;
            margin-bottom: 16px
        }

        html body code {
            font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: .85em !important;
            color: #000;
            background-color: #f0f0f0;
            border-radius: 3px;
            padding: .2em 0
        }

        html body code::before, html body code::after {
            letter-spacing: -0.2em;
            content: "\00a0"
        }

        html body pre > code {
            padding: 0;
            margin: 0;
            font-size: .85em !important;
            word-break: normal;
            white-space: pre;
            background: transparent;
            border: 0
        }

        html body .highlight {
            margin-bottom: 16px
        }

        html body .highlight pre, html body pre {
            padding: 1em;
            overflow: auto;
            font-size: .85em !important;
            line-height: 1.45;
            border: #d6d6d6;
            border-radius: 3px
        }

        html body .highlight pre {
            margin-bottom: 0;
            word-break: normal
        }

        html body pre code, html body pre tt {
            display: inline;
            max-width: initial;
            padding: 0;
            margin: 0;
            overflow: initial;
            line-height: inherit;
            word-wrap: normal;
            background-color: transparent;
            border: 0
        }

        html body pre code:before, html body pre tt:before, html body pre code:after, html body pre tt:after {
            content: normal
        }

        html body p, html body blockquote, html body ul, html body ol, html body dl, html body pre {
            margin-top: 0;
            margin-bottom: 16px
        }

        html body kbd {
            color: #000;
            border: 1px solid #d6d6d6;
            border-bottom: 2px solid #c7c7c7;
            padding: 2px 4px;
            background-color: #f0f0f0;
            border-radius: 3px
        }

        @media print {
            html body {
                background-color: #fff
            }

            html body h1, html body h2, html body h3, html body h4, html body h5, html body h6 {
                color: #000;
                page-break-after: avoid
            }

            html body blockquote {
                color: #5c5c5c
            }

            html body pre {
                page-break-inside: avoid
            }

            html body table {
                display: table
            }

            html body img {
                display: block;
                max-width: 100%;
                max-height: 100%
            }

            html body pre, html body code {
                word-wrap: break-word;
                white-space: pre
            }
        }

        .markdown-preview {
            width: 100%;
            height: 100%;
            box-sizing: border-box
        }

        .markdown-preview .pagebreak, .markdown-preview .newpage {
            page-break-before: always
        }

        .markdown-preview pre.line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber
        }

        .markdown-preview pre.line-numbers > code {
            position: relative
        }

        .markdown-preview pre.line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 1em;
            font-size: 100%;
            left: 0;
            width: 3em;
            letter-spacing: -1px;
            border-right: 1px solid #999;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none
        }

        .markdown-preview pre.line-numbers .line-numbers-rows > span {
            pointer-events: none;
            display: block;
            counter-increment: linenumber
        }

        .markdown-preview pre.line-numbers .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: .8em;
            text-align: right
        }

        .markdown-preview .mathjax-exps .MathJax_Display {
            text-align: center !important
        }

        .markdown-preview:not([for="preview"]) .code-chunk .btn-group {
            display: none
        }

        .markdown-preview:not([for="preview"]) .code-chunk .status {
            display: none
        }

        .markdown-preview:not([for="preview"]) .code-chunk .output-div {
            margin-bottom: 16px
        }

        .scrollbar-style::-webkit-scrollbar {
            width: 8px
        }

        .scrollbar-style::-webkit-scrollbar-track {
            border-radius: 10px;
            background-color: transparent
        }

        .scrollbar-style::-webkit-scrollbar-thumb {
            border-radius: 5px;
            background-color: rgba(150, 150, 150, 0.66);
            border: 4px solid rgba(150, 150, 150, 0.66);
            background-clip: content-box
        }

        html body[for="html-export"]:not([data-presentation-mode]) {
            position: relative;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            margin: 0;
            padding: 0;
            overflow: auto
        }

        html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
            position: relative;
            top: 0
        }

        @media screen and (min-width: 914px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                padding: 2em calc(50% - 457px + 2em)
            }
        }

        @media screen and (max-width: 914px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                padding: 2em
            }
        }

        @media screen and (max-width: 450px) {
            html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview {
                font-size: 14px !important;
                padding: 1em
            }
        }

        @media print {
            html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn {
                display: none
            }
        }

        html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn {
            position: fixed;
            bottom: 8px;
            left: 8px;
            font-size: 28px;
            cursor: pointer;
            color: inherit;
            z-index: 99;
            width: 32px;
            text-align: center;
            opacity: .4
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn {
            opacity: 1
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px;
            height: 100%;
            padding: 32px 0 48px 0;
            font-size: 14px;
            box-shadow: 0 0 4px rgba(150, 150, 150, 0.33);
            box-sizing: border-box;
            overflow: auto;
            background-color: inherit
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar {
            width: 8px
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track {
            border-radius: 10px;
            background-color: transparent
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb {
            border-radius: 5px;
            background-color: rgba(150, 150, 150, 0.66);
            border: 4px solid rgba(150, 150, 150, 0.66);
            background-clip: content-box
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a {
            text-decoration: none
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul {
            padding: 0 1.6em;
            margin-top: .8em
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li {
            margin-bottom: .8em
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul {
            list-style-type: none
        }

        html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
            left: 300px;
            width: calc(100% - 300px);
            padding: 2em calc(50% - 457px - 150px);
            margin: 0;
            box-sizing: border-box
        }

        @media screen and (max-width: 1274px) {
            html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
                padding: 2em
            }
        }

        @media screen and (max-width: 450px) {
            html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview {
                width: 100%
            }
        }

        html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview {
            left: 50%;
            transform: translateX(-50%)
        }

        html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc {
            display: none
        }

        html body code {
            font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: 0.85em !important;
            color: #de245c;
            background-color: #f8f8f8;
            border-radius: 3px;
            border: 1px solid #dfdfdf;
            padding: 0.2em 0;
        }

        html body {
            text-decoration: none;
        }

        html body :not(pre) > code[class*="language-"],
        html body pre[class*="language-"] {
            background: #2b2b2b;
        }

        html body :not(pre) > code[class*="language-"] code,
        html body pre[class*="language-"] code {
            color: white !important;
        }

        html body .markdown-preview .mume-header {
            border-bottom: 1px solid gainsboro;
        }

        html body .markdown-preview h2 {
            margin-bottom: 0.25em;
        }

        html body .markdown-preview h3 {
            padding-bottom: 0.5em;
            margin-bottom: 0.5em;
        }

        html body .markdown-preview h4 {
            margin-top: 1em;
            margin-bottom: 0.5em;
        }

        html body .markdown-preview h5 {
            margin-top: 1.25em;
            margin-bottom: 0.25em;
            opacity: 0.7;
        }

        html body .markdown-preview ul {
            margin-bottom: 12px;
        }

        html body .markdown-preview li.task-list-item {
            margin-left: 24px;
        }

        html body .markdown-preview blockquote {
            padding: 0 2px;
            border-left: 5px solid orange;
        }

        html body .markdown-preview blockquote p {
            background-color: #f1f1f1;
            padding: 4px 12px;
            margin-bottom: 1em;
            font-weight: 800px;
        }

        html body .markdown-preview .bt {
            border-top: 1px solid orange;
            padding-top: 12px;
        }

        html body .markdown-preview .bb {
            border-bottom: 1px solid orange;
            padding-bottom: 12px;
        }

        html body .md-header {
            padding-top: 6px;
            margin-bottom: 6px;
            border-bottom: 1px solid orange;
            border-top: 1px solid #a9a9a9;
        }

        html body .md-header h3 {
            margin-top: 0;
            margin-bottom: 6px;
        }

        html body .md-theory {
            padding-left: 24px;
            padding-top: 6px;
            color: crimson;
        }

        html body .md-theory strong {
            color: crimson;
        }

        html body .md-block-quote li {
            margin-left: 40px;
        }

        html body .md-title {
            font-size: 24px;
            font-weight: bold;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        html body .md-label {
            font-size: 16px;
            margin-top: 8px;
            margin-bottom: 0;
        }

        a html body .md-label {
            margin-bottom: 0;
        }

        html body .md-pink {
            color: hotpink;
            font-weight: bold;
        }

        html body .md-label-output {
            margin-left: 3em;
            margin-bottom: -0.35em;
        }

        html body .md-label-output--multi-line {
            margin-bottom: 0.15em;
        }

        html body .md-key {
            background-color: orange;
            color: black;
            padding: 0 0.5em 0.15em;
        }

        html body .bold {
            font-weight: bold;
        }

        html body .md-label-header {
            padding-top: 12px;
            margin-bottom: 12px;
            border-bottom: 1px solid orange;
        }

        html body .md-label-header p {
            margin-bottom: -24px;
        }

        html body .md-label-header-todo,
        html body .md-label-header-strategy {
            margin-left: 24px;
        }

        html body .md-strategy {
            margin-left: 24px;
        }

        html body a {
            text-decoration: underline;
        }

        html body a.md-link-bold {
            font-weight: bold;
        }

        html body .language-json,
        html body .language-yaml,
        html body .language-js,
        html body .language-javascript,
        html body .language-ts,
        html body .language-typescript,
        html body .language-bash,
        html body .language-shell {

            overflow: auto;
        }

        html body li .language-json,
        html body li .language-yaml,
        html body li .language-js,
        html body li .language-javascript,
        html body li .language-ts,
        html body li .language-typescript,
        html body li .language-bash,
        html body li .language-shell {


            overflow: auto;
        }

        html body .line-highlight {
            background: rgba(255, 105, 180, 0.1) !important;
            border-bottom: 1px dashed hotpink;
            border-top: 1px dashed hotpink;
            left: 0;
            line-height: inherit;
            margin-top: 0.75em;
            padding: inherit 0;
            pointer-events: none;
            position: absolute;
            right: 0;
            white-space: pre;
            z-index: 0;
        }

        html body .md-output {
            margin-left: 3em;
        }

        html body .md-output--emphasis {
            margin-top: 0.15em;
            margin-bottom: 0.15em;
        }

        html body .mb4 {
            margin-bottom: 0.25em;
        }

        html body .copy-paste-icon {
            width: 20px;
            height: 20px;
            margin-bottom: -0.25em;
            background-color: transparent;
        }

        html body .md-cmd-block {
            position: relative;
            overflow: hidden;
        }

        html body .md-cmd-block .copy-clip-icon {
            position: absolute;
            right: 0.125em;
            top: 0.525em;
            width: 20px;
            height: 20px;
            background-color: white;
            z-index: 100;
            padding: 0.15em;
        }

        html body .md-img--wrapper {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        html body .md-img {
            position: relative;
            margin: 0 auto;
        }

        html body .md-title__main {
            border-bottom: 1px solid #ebe0e0;
        }

        html body .md-alert {
            border: 0.25em solid hotpink;
            margin-top: 1em;
            padding-left: 0.5em;
            padding-right: 0.5em;
        }

        html body .redline {
            color: red;
            font-size: 1em;
            font-weight: bold;
        }

        html body .mt-12 {
            margin-top: 0.5em;
        }

        html body .mb-12 {
            margin-bottom: 0.5em;
        }

        html body .md-code-chunk {
            background-color: orange;
            padding: 2px 8px 6px;
        }

        html body iframe .tabs.bartabs {
            display: none;
        }

        html body span.token.comment {
            font-family: Menlo, Monaco, Consolas, 'Courier New', monospace;
            font-size: 0.85em !important;
            color: #2387af;
            border-radius: 3px;
            padding: 0.2em 0;
        }

    </style>

</head>
<body for="html-export">
<div class="mume markdown-preview">

    <pre data-role="codeBlock" data-info="js" class="language-javascript"><span
                class="token function">require</span><span class="token punctuation">(</span><span class="token string">&apos;dotenv&apos;</span><span
                class="token punctuation">)</span><span class="token punctuation">.</span><span
                class="token method function property-access">config</span><span class="token punctuation">(</span><span
                class="token punctuation">)</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;config&apos;</span><span
                class="token punctuation">)</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;chalk&apos;</span><span
                class="token punctuation">)</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;request&apos;</span><span
                class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> v4<span
                class="token operator">:</span> uuid <span class="token punctuation">}</span> <span
                class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;uuid&apos;</span><span
                class="token punctuation">)</span>

<span class="token keyword">const</span> isJson <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;is-json&apos;</span><span
                class="token punctuation">)</span>
<span class="token keyword">const</span> _config <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span
                class="token string">&apos;../../config/local.json&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> _error <span class="token operator">=</span> <span class="token function">require</span><span
                class="token punctuation">(</span><span class="token string">&apos;../_helpers/_error&apos;</span><span
                class="token punctuation">)</span>

<span class="token keyword">const</span> oidc <span class="token operator">=</span> <span
                class="token punctuation">{</span>
  config<span class="token operator">:</span> config<span class="token punctuation">.</span><span
                class="token method function property-access">get</span><span class="token punctuation">(</span><span
                class="token string">&apos;okta&apos;</span><span class="token punctuation">)</span><span
                class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">authz_header</span> <span
                class="token operator">=</span> <span class="token punctuation">(</span><span
                class="token parameter"><span class="token punctuation">{</span> client_id<span
                    class="token punctuation">,</span> client_secret <span
                    class="token punctuation">}</span></span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token maybe-class-name">Basic</span> <span
                class="token operator">=</span> <span class="token string">&apos;Basic &apos;</span> <span
                class="token operator">+</span>
      <span class="token maybe-class-name">Buffer</span><span class="token punctuation">.</span><span
                class="token keyword module">from</span><span class="token punctuation">(</span><span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>client_id<span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token string">:</span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>client_secret<span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span><span
                class="token punctuation">)</span><span class="token punctuation">.</span><span
                class="token method function property-access">toString</span><span
                class="token punctuation">(</span><span class="token string">&apos;base64&apos;</span><span
                class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    <span class="token maybe-class-name">Accept</span><span class="token operator">:</span> <span class="token string">&apos;application/json&apos;</span><span
                class="token punctuation">,</span>
    <span class="token string">&apos;Content-Type&apos;</span><span class="token operator">:</span> <span
                class="token string">&apos;application/x-www-form-urlencoded&apos;</span><span
                class="token punctuation">,</span>
    authorization<span class="token operator">:</span> <span class="token maybe-class-name">Basic</span><span
                class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">make_error_handler</span> <span
                class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">emitter</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">(</span><span class="token parameter">err</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span
                class="token punctuation">.</span><span class="token property-access">type</span><span
                class="token punctuation">)</span> <span class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span
                class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span
                class="token punctuation">,</span> <span class="token template-string"><span
                    class="token template-punctuation string">`</span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span><span
                        class="token property-access">type</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token string"> - </span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>err<span class="token punctuation">.</span><span
                        class="token property-access">text</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span
                class="token punctuation">{</span>
    emitter<span class="token punctuation">.</span><span class="token method function property-access">emit</span><span
                class="token punctuation">(</span><span class="token string">&apos;error&apos;</span><span
                class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">get_iat_exp</span> <span
                class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> hr_ms <span class="token operator">=</span> <span
                class="token number">3.6e6</span>
  <span class="token keyword">let</span> iaf <span class="token operator">=</span> <span
                class="token keyword">new</span> <span class="token class-name">Date</span><span
                class="token punctuation">(</span><span class="token punctuation">)</span><span
                class="token punctuation">.</span><span
                class="token method function property-access">getTime</span><span
                class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> exf <span class="token operator">=</span> iaf <span
                class="token operator">+</span> hr_ms
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    okta<span class="token operator">:</span> <span class="token punctuation">{</span>
      iat<span class="token operator">:</span> <span class="token known-class-name class-name">Math</span><span
                class="token punctuation">.</span><span class="token method function property-access">floor</span><span
                class="token punctuation">(</span>iaf <span class="token operator">/</span> <span class="token number">1000</span><span
                class="token punctuation">)</span><span class="token punctuation">,</span>
      exp<span class="token operator">:</span> <span class="token known-class-name class-name">Math</span><span
                class="token punctuation">.</span><span class="token method function property-access">floor</span><span
                class="token punctuation">(</span>exf <span class="token operator">/</span> <span class="token number">1000</span><span
                class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    iat<span class="token operator">:</span> iaf<span class="token punctuation">,</span>
    exp<span class="token operator">:</span> exf<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">resolve_query</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">query</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span
                class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>query<span
                class="token punctuation">.</span><span class="token property-access">state</span><span
                class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> split <span class="token operator">=</span> query<span
                class="token punctuation">.</span><span class="token property-access">state</span><span
                class="token punctuation">.</span><span class="token method function property-access">split</span><span
                class="token punctuation">(</span><span class="token string">&apos;___&apos;</span><span
                class="token punctuation">)</span>
    result <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token spread operator">...</span>query<span class="token punctuation">,</span>
      openid_provider<span class="token operator">:</span> split<span class="token punctuation">[</span><span
                class="token number">0</span><span class="token punctuation">]</span><span
                class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> result
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span
                class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> query
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">resolve_config</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">provider</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>oidc<span
                class="token punctuation">[</span><span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">get_config</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">query<span
                    class="token punctuation">,</span> from_method</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _creds <span class="token operator">=</span> _config<span
                class="token punctuation">[</span><span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">]</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    openid_provider<span class="token operator">:</span> <span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">,</span>
    <span class="token spread operator">...</span>_creds<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">get_auth_params</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">query</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span
                class="token method function property-access">log</span><span
                class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span
                class="token method function property-access">bgRed</span><span class="token punctuation">(</span><span
                class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span
                class="token method function property-access">stringify</span><span class="token punctuation">(</span>query<span
                class="token punctuation">,</span> <span class="token keyword null nil">null</span><span
                class="token punctuation">,</span> <span class="token number">2</span><span
                class="token punctuation">)</span><span class="token punctuation">)</span><span
                class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> openid_provider <span class="token operator">=</span> query<span
                class="token punctuation">.</span><span class="token property-access">openid_provider</span>
    <span class="token keyword">const</span> openid_config <span class="token operator">=</span> config<span
                class="token punctuation">.</span><span class="token method function property-access">get</span><span
                class="token punctuation">(</span>openid_provider<span class="token punctuation">)</span>
    <span class="token keyword">const</span> _state <span class="token operator">=</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>openid_provider<span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">___</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span
                        class="token function">uuid</span><span class="token punctuation">(</span><span
                        class="token punctuation">)</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span>
    <span class="token keyword">const</span> _nonce <span class="token operator">=</span> <span class="token keyword">new</span> <span
                class="token class-name">Date</span><span class="token punctuation">(</span><span
                class="token punctuation">)</span><span class="token punctuation">.</span><span
                class="token method function property-access">getTime</span><span
                class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> _scope <span class="token operator">=</span> <span class="token string">&apos;openid email phone profile&apos;</span>
    <span class="token keyword">const</span> _params <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      response_type<span class="token operator">:</span> <span class="token string">&apos;code&apos;</span><span
                class="token punctuation">,</span>
      client_id<span class="token operator">:</span> openid_config<span class="token punctuation">[</span><span
                class="token string">&apos;client_id&apos;</span><span class="token punctuation">]</span><span
                class="token punctuation">,</span>
      redirect_uri<span class="token operator">:</span> openid_config<span class="token punctuation">[</span><span
                class="token string">&apos;uri_redirect&apos;</span><span class="token punctuation">]</span><span
                class="token punctuation">,</span>
      scope<span class="token operator">:</span> _scope<span class="token punctuation">,</span>
      state<span class="token operator">:</span> _state<span class="token punctuation">,</span>
      nonce<span class="token operator">:</span> _nonce<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      openid_provider<span class="token operator">:</span> openid_provider<span class="token punctuation">,</span>
      auth_uri<span class="token operator">:</span> openid_config<span class="token punctuation">[</span><span
                class="token string">&apos;authorization_endpoint&apos;</span><span
                class="token punctuation">]</span><span class="token punctuation">,</span>
      params<span class="token operator">:</span> _params<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>result<span
                class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">get_auth_url</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> oidc <span class="token operator">=</span> config<span
                class="token punctuation">.</span><span class="token method function property-access">get</span><span
                class="token punctuation">(</span><span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">)</span>
  <span class="token keyword">const</span> _state <span class="token operator">=</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span
                        class="token string">&apos;okta&apos;</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">___</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span
                        class="token function">uuid</span><span class="token punctuation">(</span><span
                        class="token punctuation">)</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span>
  <span class="token keyword">const</span> _nonce <span class="token operator">=</span> <span
                class="token keyword">new</span> <span class="token class-name">Date</span><span
                class="token punctuation">(</span><span class="token punctuation">)</span><span
                class="token punctuation">.</span><span
                class="token method function property-access">getTime</span><span
                class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> _scope <span class="token operator">=</span> <span class="token string">&apos;openid email phone profile&apos;</span>
  <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
    response_type<span class="token operator">:</span> <span class="token string">&apos;code&apos;</span><span
                class="token punctuation">,</span>
    client_id<span class="token operator">:</span> oidc<span class="token punctuation">[</span><span
                class="token string">&apos;client_id&apos;</span><span class="token punctuation">]</span><span
                class="token punctuation">,</span>
    redirect_uri<span class="token operator">:</span> oidc<span class="token punctuation">[</span><span
                class="token string">&apos;uri_redirect&apos;</span><span class="token punctuation">]</span><span
                class="token punctuation">,</span>
    scope<span class="token operator">:</span> _scope<span class="token punctuation">,</span>
    state<span class="token operator">:</span> _state<span class="token punctuation">,</span>
    nonce<span class="token operator">:</span> _nonce<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> params_str <span class="token operator">=</span> <span
                class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span
                class="token method function property-access">entries</span><span class="token punctuation">(</span>params<span
                class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token method function property-access">map</span><span class="token punctuation">(</span><span
                class="token punctuation">(</span><span class="token parameter">arr</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>arr<span class="token punctuation">[</span><span
                        class="token number">0</span><span class="token punctuation">]</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token string">=</span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>arr<span class="token punctuation">[</span><span
                        class="token number">1</span><span class="token punctuation">]</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span><span
                class="token punctuation">)</span><span class="token punctuation">.</span>
    <span class="token method function property-access">join</span><span class="token punctuation">(</span><span
                class="token string">&apos;&amp;&apos;</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> authenticate_url <span class="token operator">=</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>oidc<span
                        class="token punctuation">[</span><span
                        class="token string">&apos;authorization_endpoint&apos;</span><span
                        class="token punctuation">]</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token string">?</span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>params_str<span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span
                class="token punctuation">{</span>
      message<span class="token operator">:</span> <span
                class="token string">&apos;openid.get_auth_url&apos;</span><span class="token punctuation">,</span>
      params<span class="token operator">:</span> params<span class="token punctuation">,</span>
      authenticate_url<span class="token operator">:</span> authenticate_url<span class="token punctuation">,</span>
      openid_provider<span class="token operator">:</span> <span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">get_auth_method</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">query<span
                    class="token punctuation">,</span> jwt_params</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token punctuation">(</span><span class="token parameter">resolve</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
    <span class="token keyword">const</span> openid_provider <span class="token operator">=</span> <span
                class="token string">&apos;okta&apos;</span>
    <span class="token keyword">const</span> _creds <span class="token operator">=</span> _config<span
                class="token punctuation">[</span>openid_provider<span class="token punctuation">]</span>
    <span class="token keyword">const</span> client_id <span class="token operator">=</span> _creds<span
                class="token punctuation">[</span><span class="token string">&apos;client_id&apos;</span><span
                class="token punctuation">]</span>
    <span class="token keyword">const</span> client_secret <span class="token operator">=</span> _creds<span
                class="token punctuation">[</span><span class="token string">&apos;client_secret&apos;</span><span
                class="token punctuation">]</span>
    <span class="token keyword">const</span> token_endpoint <span class="token operator">=</span> _creds<span
                class="token punctuation">[</span><span class="token string">&apos;token_endpoint&apos;</span><span
                class="token punctuation">]</span>
    <span class="token keyword">const</span> redirect_uri <span class="token operator">=</span> _creds<span
                class="token punctuation">[</span><span class="token string">&apos;uri_redirect&apos;</span><span
                class="token punctuation">]</span>
    <span class="token keyword">const</span> code <span class="token operator">=</span> query<span
                class="token punctuation">.</span><span class="token property-access">code</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> query<span
                class="token punctuation">.</span><span class="token property-access">state</span>
    <span class="token keyword">const</span> client_secret_basic_params <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      client_id<span class="token operator">:</span> client_id<span class="token punctuation">,</span>
      grant_type<span class="token operator">:</span> <span
                class="token string">&apos;authorization_code&apos;</span><span class="token punctuation">,</span>
      code<span class="token operator">:</span> code<span class="token punctuation">,</span>
      redirect_uri<span class="token operator">:</span> redirect_uri<span class="token punctuation">,</span>
      state<span class="token operator">:</span> state<span class="token punctuation">,</span>
      client_secret<span class="token operator">:</span> client_secret<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> client_secret_basic <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">&apos;POST&apos;</span><span
                class="token punctuation">,</span>
      url<span class="token operator">:</span> token_endpoint<span class="token punctuation">,</span>
      qs<span class="token operator">:</span> client_secret_basic_params<span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token function">authz_header</span><span
                class="token punctuation">(</span><span class="token punctuation">{</span> client_id<span
                class="token punctuation">,</span> client_secret <span class="token punctuation">}</span><span
                class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> client_secret_jwt <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">&apos;POST&apos;</span><span
                class="token punctuation">,</span>
      url<span class="token operator">:</span> token_endpoint<span class="token punctuation">,</span>
      qs<span class="token operator">:</span> jwt_params<span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string">&apos;Content-Type&apos;</span><span class="token operator">:</span> <span
                class="token string">&apos;application/x-www-form-urlencoded&apos;</span><span
                class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>openid_provider <span
                class="token operator">===</span> <span class="token string">&apos;okta&apos;</span><span
                class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span
                class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">&apos;client_secret_jwt&apos;</span><span
                class="token punctuation">,</span>
        options<span class="token operator">:</span> client_secret_jwt<span class="token punctuation">,</span>
        openid_provider<span class="token operator">:</span> openid_provider<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span
                class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>openid_provider <span
                class="token operator">===</span> <span class="token string">&apos;pingfederate&apos;</span> <span
                class="token operator">||</span> openid_provider <span class="token operator">===</span> <span
                class="token string">&apos;pingone&apos;</span><span class="token punctuation">)</span> <span
                class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span
                class="token punctuation">{</span>
          name<span class="token operator">:</span> <span
                class="token string">&apos;client_secret_basic&apos;</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> client_secret_basic<span class="token punctuation">,</span>
          openid_provider<span class="token operator">:</span> openid_provider<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">token</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">query<span
                    class="token punctuation">,</span> jwt_params</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> auth_method <span class="token operator">=</span> <span
                class="token keyword control-flow">await</span> <span class="token keyword">this</span><span
                class="token punctuation">.</span><span
                class="token method function property-access">get_auth_method</span><span
                class="token punctuation">(</span>query<span class="token punctuation">,</span> jwt_params<span
                class="token punctuation">)</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> auth_method<span
                class="token punctuation">.</span><span class="token property-access">options</span>
    <span class="token keyword">const</span> openid_provider <span class="token operator">=</span> auth_method<span
                class="token punctuation">.</span><span class="token property-access">openid_provider</span>
    <span class="token function">request</span><span class="token punctuation">(</span>options<span
                class="token punctuation">,</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">err<span
                    class="token punctuation">,</span> response<span class="token punctuation">,</span> body</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>err<span
                class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> error <span class="token operator">=</span> <span
                class="token punctuation">{</span>
          type<span class="token operator">:</span> <span
                class="token string">&apos;config_create_error&apos;</span><span class="token punctuation">,</span>
          file<span class="token operator">:</span> <span class="token string">&apos;_configEnv.js&apos;</span><span
                class="token punctuation">,</span>
          method<span class="token operator">:</span> <span
                class="token string">&apos;_configEnv(_docker.config)&apos;</span><span
                class="token punctuation">,</span>
          error<span class="token operator">:</span> err<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token function">_error</span><span class="token punctuation">(</span>error<span
                class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span
                class="token punctuation">{</span>
          status_code<span class="token operator">:</span> response<span class="token punctuation">.</span><span
                class="token property-access">statusCode</span><span class="token punctuation">,</span>
          success<span class="token operator">:</span> <span class="token boolean">false</span><span
                class="token punctuation">,</span>
          error<span class="token operator">:</span> error<span class="token punctuation">,</span>
          openid_provider<span class="token operator">:</span> openid_provider<span class="token punctuation">,</span>
          response_headers<span class="token operator">:</span> response<span class="token punctuation">.</span><span
                class="token property-access">headers</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> _body <span class="token operator">=</span> <span class="token function">isJson</span><span
                class="token punctuation">(</span>body<span class="token punctuation">)</span> <span
                class="token operator">?</span> <span class="token known-class-name class-name">JSON</span><span
                class="token punctuation">.</span><span class="token method function property-access">parse</span><span
                class="token punctuation">(</span>body<span class="token punctuation">)</span> <span
                class="token operator">:</span> body
      <span class="token keyword">const</span> obj <span class="token operator">=</span> <span
                class="token punctuation">{</span>
        status_code<span class="token operator">:</span> response<span class="token punctuation">.</span><span
                class="token property-access">statusCode</span><span class="token punctuation">,</span>
        success<span class="token operator">:</span> <span class="token boolean">true</span><span
                class="token punctuation">,</span>
        body<span class="token operator">:</span> _body<span class="token punctuation">,</span>
        openid_provider<span class="token operator">:</span> openid_provider<span class="token punctuation">,</span>
        response_headers<span class="token operator">:</span> response<span class="token punctuation">.</span><span
                class="token property-access">headers</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>obj<span
                class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">userinfo</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">access_token</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword">const</span> _config <span class="token operator">=</span> oidc<span
                class="token punctuation">.</span><span class="token property-access">config</span>
  <span class="token keyword">const</span> userinfo_endpoint <span class="token operator">=</span> _config<span
                class="token punctuation">[</span><span class="token string">&apos;userinfo_endpoint&apos;</span><span
                class="token punctuation">]</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span
                class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">&apos;GET&apos;</span><span
                class="token punctuation">,</span>
    url<span class="token operator">:</span> userinfo_endpoint<span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token maybe-class-name">Authorization</span><span class="token operator">:</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token string">Bearer </span><span class="token interpolation"><span
                        class="token interpolation-punctuation punctuation">${</span>access_token<span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">request</span><span class="token punctuation">(</span>options<span
                class="token punctuation">,</span> <span class="token keyword">function</span><span
                class="token punctuation">(</span><span class="token parameter">error<span
                    class="token punctuation">,</span> response<span class="token punctuation">,</span> body</span><span
                class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>response<span
                class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">validate_token</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">token<span
                    class="token punctuation">,</span> token_type_hint</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span
                class="token class-name">Promise</span><span class="token punctuation">(</span><span
                class="token keyword">async</span> <span class="token punctuation">(</span><span
                class="token parameter">resolve</span><span class="token punctuation">)</span> <span
                class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> client_id <span class="token operator">=</span> oidc<span
                class="token punctuation">.</span><span class="token property-access">config</span><span
                class="token punctuation">.</span><span class="token property-access">client_id</span>
    <span class="token keyword">const</span> client_secret <span class="token operator">=</span> oidc<span
                class="token punctuation">.</span><span class="token property-access">config</span><span
                class="token punctuation">.</span><span class="token property-access">client_secret</span>
    <span class="token keyword">const</span> introspection_endpoint <span class="token operator">=</span> oidc<span
                class="token punctuation">.</span><span class="token property-access">config</span><span
                class="token punctuation">.</span><span class="token property-access">introspection_endpoint</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span
                class="token punctuation">{</span>
      method<span class="token operator">:</span> <span class="token string">&apos;POST&apos;</span><span
                class="token punctuation">,</span>
      url<span class="token operator">:</span> introspection_endpoint<span class="token punctuation">,</span>
      qs<span class="token operator">:</span> <span class="token punctuation">{</span>
        token<span class="token operator">:</span> token<span class="token punctuation">,</span>
        token_type_hint<span class="token operator">:</span> token_type_hint<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      headers<span class="token operator">:</span> <span class="token function">authz_header</span><span
                class="token punctuation">(</span><span class="token punctuation">{</span> client_id<span
                class="token punctuation">,</span> client_secret <span class="token punctuation">}</span><span
                class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token function">request</span><span class="token punctuation">(</span>options<span
                class="token punctuation">,</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">error<span
                    class="token punctuation">,</span> response<span class="token punctuation">,</span> body</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
      <span class="token keyword">let</span> _body <span class="token operator">=</span> <span class="token function">isJson</span><span
                class="token punctuation">(</span>body<span class="token punctuation">)</span> <span
                class="token operator">?</span> <span class="token known-class-name class-name">JSON</span><span
                class="token punctuation">.</span><span class="token method function property-access">parse</span><span
                class="token punctuation">(</span>body<span class="token punctuation">)</span> <span
                class="token operator">:</span> body
      <span class="token function">resolve</span><span class="token punctuation">(</span>_body<span
                class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span><span
                class="token punctuation">.</span><span
                class="token method-variable function-variable method function property-access">logout</span> <span
                class="token operator">=</span> <span class="token keyword">async</span> <span
                class="token punctuation">(</span><span class="token parameter">ctx</span><span
                class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span
                class="token punctuation">{</span>
  <span class="token keyword">const</span> id_token <span class="token operator">=</span> ctx<span
                class="token punctuation">.</span><span class="token property-access">cookies</span><span
                class="token punctuation">.</span><span class="token method function property-access">get</span><span
                class="token punctuation">(</span><span class="token string">&apos;ID_TOKEN&apos;</span><span
                class="token punctuation">)</span>
  <span class="token keyword">const</span> _config <span class="token operator">=</span> oidc<span
                class="token punctuation">.</span><span class="token property-access">config</span>
  <span class="token keyword">const</span> end_session_endpoint <span class="token operator">=</span> _config<span
                class="token punctuation">[</span><span
                class="token string">&apos;end_session_endpoint&apos;</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> post_logout_redirect_uri <span class="token operator">=</span> _config<span
                class="token punctuation">[</span><span class="token string">&apos;uri_redirect_logout&apos;</span><span
                class="token punctuation">]</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>_config<span
                        class="token punctuation">[</span><span
                        class="token string">&apos;openid_provider&apos;</span><span
                        class="token punctuation">]</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">___</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span
                        class="token function">uuid</span><span class="token punctuation">(</span><span
                        class="token punctuation">)</span><span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span>
  <span class="token keyword">const</span> logout_url <span class="token operator">=</span> <span
                class="token template-string"><span class="token template-punctuation string">`</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end_session_endpoint<span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?id_token_hint=</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id_token<span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;post_logout_redirect_uri=</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>post_logout_redirect_uri<span
                        class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;state=</span><span
                    class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span
                        class="token interpolation-punctuation punctuation">}</span></span><span
                    class="token template-punctuation string">`</span></span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    logout_url<span class="token operator">:</span> logout_url<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</pre>
</div>


</body>
</html>